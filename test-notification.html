<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate Limit Monitor - é€šçŸ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 700px;
            margin: 30px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        
        .notification-demo {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .step {
            margin-bottom: 25px;
            padding: 20px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
            border-radius: 0 8px 8px 0;
        }
        
        .step h3 {
            margin-top: 0;
            color: #007bff;
            font-size: 18px;
        }
        
        .step p {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .test-btn {
            background: #28a745;
        }
        
        .test-btn:hover {
            background: #218838;
        }
        
        .config-btn {
            background: #ffc107;
            color: #212529;
        }
        
        .config-btn:hover {
            background: #e0a800;
        }
        
        .backend-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        
        .backend-info strong {
            color: #0066cc;
        }
        
        code {
            background: #e9ecef;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .notification-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .notification-type {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid transparent;
        }
        
        .type-detect {
            background: #fff3cd;
            border-color: #ffeaa7;
        }
        
        .type-sending {
            background: #cce5ff;
            border-color: #99ccff;
        }
        
        .type-success {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        
        .type-error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .type-config {
            background: #e2e3e5;
            border-color: #d6d8db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”” Rate Limit Monitor é€šçŸ¥æµ‹è¯•</h1>
        
        <div class="notification-demo">
            <h2>ğŸ“± é€šçŸ¥åŠŸèƒ½æ¼”ç¤º</h2>
            <p>æµ‹è¯•æ‰©å±•çš„å„ç§é€šçŸ¥ç±»å‹ï¼Œç¡®ä¿åç«¯å‘é€åŠŸèƒ½æ­£å¸¸å·¥ä½œ</p>
        </div>
        
        <div class="step">
            <h3>ğŸ”§ æ­¥éª¤ 1: é…ç½®åç«¯</h3>
            <p>é¦–å…ˆé…ç½®æ‰©å±•çš„åç«¯åœ°å€ï¼š</p>
            <div class="backend-info">
                <strong>åç«¯åœ°å€:</strong> <code>http://localhost:8787/api/rate-limit</code>
            </div>
            <p>1. ç‚¹å‡»æµè§ˆå™¨å³ä¸Šè§’çš„æ‰©å±•å›¾æ ‡</p>
            <p>2. åœ¨"åç«¯é…ç½®"åŒºåŸŸè¾“å…¥ä¸Šé¢çš„åœ°å€</p>
            <p>3. å‹¾é€‰"å¯ç”¨åç«¯å‘é€"</p>
            <p>4. ç‚¹å‡»"ä¿å­˜é…ç½®" - åº”è¯¥ä¼šçœ‹åˆ°é…ç½®æˆåŠŸé€šçŸ¥</p>
            <button onclick="openExtensionPopup()" class="config-btn">æ‰“å¼€æ‰©å±•é…ç½®</button>
        </div>
        
        <div class="step">
            <h3>ğŸ§ª æ­¥éª¤ 2: æµ‹è¯•é€šçŸ¥ç±»å‹</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•ä¸åŒç±»å‹çš„é€šçŸ¥ï¼š</p>
            
            <div class="notification-types">
                <div class="notification-type type-detect">
                    <h4>ğŸš« æ£€æµ‹é€šçŸ¥</h4>
                    <p>æ£€æµ‹åˆ°Rate Limitæ—¶æ˜¾ç¤º</p>
                    <button onclick="testDetectionNotification()" class="test-btn">æµ‹è¯•æ£€æµ‹</button>
                </div>
                
                <div class="notification-type type-sending">
                    <h4>ğŸ“¡ å‘é€ä¸­é€šçŸ¥</h4>
                    <p>æ­£åœ¨å‘é€æ•°æ®åˆ°åç«¯</p>
                    <button onclick="testSendingNotification()" class="test-btn">æµ‹è¯•å‘é€ä¸­</button>
                </div>
                
                <div class="notification-type type-success">
                    <h4>âœ… æˆåŠŸé€šçŸ¥</h4>
                    <p>æ•°æ®å‘é€æˆåŠŸ</p>
                    <button onclick="testSuccessNotification()" class="test-btn">æµ‹è¯•æˆåŠŸ</button>
                </div>
                
                <div class="notification-type type-error">
                    <h4>âŒ é”™è¯¯é€šçŸ¥</h4>
                    <p>å‘é€å¤±è´¥æˆ–ç½‘ç»œé”™è¯¯</p>
                    <button onclick="testErrorNotification()" class="test-btn">æµ‹è¯•é”™è¯¯</button>
                </div>
            </div>
        </div>
        
        <div class="step">
            <h3>ğŸš€ æ­¥éª¤ 3: å®Œæ•´æµç¨‹æµ‹è¯•</h3>
            <p>æµ‹è¯•å®Œæ•´çš„Rate Limitæ£€æµ‹å’Œåç«¯å‘é€æµç¨‹ï¼š</p>
            <button onclick="testFullFlow()" class="test-btn">å®Œæ•´æµç¨‹æµ‹è¯•</button>
            <p><small>è¿™å°†è§¦å‘ï¼šæ£€æµ‹é€šçŸ¥ â†’ å‘é€ä¸­é€šçŸ¥ â†’ æˆåŠŸ/å¤±è´¥é€šçŸ¥</small></p>
        </div>
        
        <div class="step">
            <h3>ğŸ“‹ é¢„æœŸç»“æœ</h3>
            <p>å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š</p>
            <ul>
                <li>ğŸ”” æµè§ˆå™¨å³ä¸‹è§’å‡ºç°é€šçŸ¥å¼¹çª—</li>
                <li>ğŸ“± é€šçŸ¥åŒ…å«ç›¸å…³çš„ç»„ç»‡IDå’Œæ—¶é—´ä¿¡æ¯</li>
                <li>âœ… åç«¯æœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ®ï¼ˆæ£€æŸ¥ä½ çš„åç«¯æ—¥å¿—ï¼‰</li>
                <li>â° é€šçŸ¥ä¼šåœ¨å‡ ç§’åè‡ªåŠ¨æ¶ˆå¤±</li>
            </ul>
        </div>
    </div>

    <script>
        function openExtensionPopup() {
            alert('è¯·ç‚¹å‡»æµè§ˆå™¨å³ä¸Šè§’çš„æ‰©å±•å›¾æ ‡ï¼ˆğŸš«ï¼‰æ¥æ‰“å¼€é…ç½®é¢æ¿');
        }
        
        function testDetectionNotification() {
            // æ¨¡æ‹Ÿæ£€æµ‹åˆ°rate limit
            const orgId = 'org_test_' + Date.now();
            const resetAt = Math.floor(Date.now() / 1000) + 300;
            
            window.dispatchEvent(new CustomEvent('rateLimitDetected', {
                detail: {
                    url: `https://demo.fuclaude.com/api/organizations/${orgId}/completion`,
                    domain: 'demo.fuclaude.com',
                    resetAt: resetAt,
                    status: 429,
                    orgId: orgId,
                    apiType: 'fuclaude-test',
                    timestamp: Date.now()
                }
            }));
            
            console.log('âœ… æ£€æµ‹é€šçŸ¥æµ‹è¯•å·²è§¦å‘');
        }
        
        function testSendingNotification() {
            // è¿™ä¸ªéœ€è¦é€šè¿‡background scriptæ¥è§¦å‘ï¼Œè¿™é‡Œåªæ˜¯æ¼”ç¤º
            console.log('ğŸ“¡ å‘é€ä¸­é€šçŸ¥ä¼šåœ¨å®é™…å‘é€æ—¶è‡ªåŠ¨æ˜¾ç¤º');
            alert('å‘é€ä¸­é€šçŸ¥ä¼šåœ¨å®é™…å‘é€æ•°æ®åˆ°åç«¯æ—¶è‡ªåŠ¨æ˜¾ç¤º\nè¯·ä½¿ç”¨"å®Œæ•´æµç¨‹æµ‹è¯•"æ¥æŸ¥çœ‹');
        }
        
        function testSuccessNotification() {
            console.log('âœ… æˆåŠŸé€šçŸ¥ä¼šåœ¨åç«¯å“åº”æˆåŠŸæ—¶è‡ªåŠ¨æ˜¾ç¤º');
            alert('æˆåŠŸé€šçŸ¥ä¼šåœ¨åç«¯å“åº”æˆåŠŸæ—¶è‡ªåŠ¨æ˜¾ç¤º\nè¯·ç¡®ä¿åç«¯æœåŠ¡å™¨æ­£åœ¨è¿è¡Œå¹¶ä½¿ç”¨"å®Œæ•´æµç¨‹æµ‹è¯•"');
        }
        
        function testErrorNotification() {
            console.log('âŒ é”™è¯¯é€šçŸ¥ä¼šåœ¨åç«¯å“åº”å¤±è´¥æ—¶è‡ªåŠ¨æ˜¾ç¤º');
            alert('é”™è¯¯é€šçŸ¥ä¼šåœ¨åç«¯å“åº”å¤±è´¥æ—¶è‡ªåŠ¨æ˜¾ç¤º\nå¯ä»¥æ•…æ„é…ç½®é”™è¯¯çš„åç«¯åœ°å€æ¥æµ‹è¯•');
        }
        
        function testFullFlow() {
            // æ¨¡æ‹Ÿå®Œæ•´çš„rate limitæ£€æµ‹æµç¨‹
            const orgId = 'org_full_test_' + Date.now();
            const resetAt = Math.floor(Date.now() / 1000) + 600; // 10åˆ†é’Ÿå
            
            console.log('ğŸš€ å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯•...');
            console.log(`ç»„ç»‡ID: ${orgId}`);
            console.log(`é‡ç½®æ—¶é—´: ${resetAt} (${new Date(resetAt * 1000).toLocaleString()})`);
            
            // è§¦å‘rate limitæ£€æµ‹äº‹ä»¶
            window.dispatchEvent(new CustomEvent('rateLimitDetected', {
                detail: {
                    url: `https://demo.fuclaude.com/api/organizations/${orgId}/chat_conversations/conv_test/completion`,
                    domain: 'demo.fuclaude.com',
                    resetAt: resetAt,
                    status: 429,
                    orgId: orgId,
                    conversationId: 'conv_test',
                    apiType: 'fuclaude-chat',
                    timestamp: Date.now()
                }
            }));
            
            alert(`å®Œæ•´æµç¨‹æµ‹è¯•å·²å¼€å§‹ï¼\n\nç»„ç»‡ID: ${orgId}\né‡ç½®æ—¶é—´: ${new Date(resetAt * 1000).toLocaleString()}\n\nè¯·è§‚å¯Ÿé€šçŸ¥å¼¹çª—å’Œåç«¯æ—¥å¿—`);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.addEventListener('load', () => {
            console.log('ğŸ”” é€šçŸ¥æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“‹ è¯·æŒ‰ç…§æ­¥éª¤è¿›è¡Œæµ‹è¯•');
        });
    </script>
</body>
</html>
